<!DOCTYPE html> 
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width" , initial-scale="1">
        <title>money-mate</title>
    </head> 
    <body>
        <div class="title" id="title" ></div>
        <div id="table" class="table"></div>
        <detail-table id="test"></detail-table>
    </body>
      <script src="./components/TableRow.js"></script> 
      <script src="./components/DetailTable.js"></script>
      <script src="./data.js"></script>
</html>

<script>
    const titleElement = document.getElementById('title')
    const date = new Date()
    titleElement.innerText = `${date.getFullYear()}년 ${date.getMonth() + 1}월 머니메이트 랭킹`

    const userList = {}

    Object.entries(userData)
        .filter(([day, _]) => day.startsWith(`${date.getFullYear()}.${date.getMonth()+1}`))
        .map(([day, dayData]) => {
        for([name, point] of Object.entries(dayData)) {
            if(!userList[name]){
                userList[name] = {
                    point,
                    victoryDay: point === 3 ? 1 : 0,
                    dailyInfo: {
                        [day]: point,
                    }
                }
            }else{
                userList[name].point += point
                userList[name].victoryDay += point === 3 ? 1 : 0
                userList[name].dailyInfo[day] = point;
            }
        }
    })


    const table = document.getElementById('table')
    let index = 0;

    for([name, value] of Object.entries(userList).sort( ([,a], [,b]) => b.point - a.point )){
        const tableRow = document.createElement('table-row')
        tableRow.setAttribute('number', ++index)
        tableRow.setAttribute('image', image[name] || 'blank.png')
        tableRow.setAttribute('name', name)
        tableRow.setAttribute('point', value.point)
        tableRow.setAttribute('victoryDay', value.victoryDay)
        tableRow.addEventListener('click', clickRow(index), false)
        table.appendChild(tableRow)
    }

    function clickRow(number){
        return () => {
            const nodeList = Array.from(table.childNodes)
            const targetRow = nodeList.find(row => row.getAttributeNode('number').value === number.toString() )
            
            if(targetRow.childElementCount === 1) {
                const detailTable = document.createElement('detail-table')
                const name = targetRow.getAttribute('name')
                detailTable.setData(userList[name].dailyInfo)
                targetRow.appendChild(detailTable)
            }else{
                const detailTable = targetRow.lastChild
                targetRow.removeChild(detailTable)
            }
        }
    }
</script>

<style>
    body {
        background-color: #D3C0D3;
        padding-left: 6px;
        padding-right: 6px;
        text-align: center;
    }
    .title{
        font-size: 18px;
        margin: 16px;
        color: #2B2B2B;
    }
    .table{
        background-color: white;
        border-radius: 4px;
        padding-top: 15px;
    }
    span {
        display: inline-block;
        vertical-align: middle;
    }
</style>